{% extends "base.html" %}

{% block content %}
<div x-show="isAuthenticated && onboardingStep === null && onboardingStep !== 'checking'" x-cloak class="app-shell">

    <!-- App Header with Navigation (BoilerBuddy Style) -->
    <!-- App Header with Navigation (Paper Header) -->
    <!-- App Header with Navigation (Paper Header) -->
    <header class="app-header bg-white dark:bg-[#0f172a] border-b border-slate-200/60 dark:border-white/5"
        role="banner">
        <div class="app-header-content">
            <!-- Left: Logo -->
            <div class="app-header-left flex items-center gap-3">
                <a href="{{ url_for('dashboard') }}" class="flex items-center gap-3 group">
                    <div
                        class="w-10 h-10 rounded-xl flex items-center justify-center bg-black dark:bg-slate-800 group-hover:bg-slate-900 dark:group-hover:bg-slate-700 transition-colors">
                        <i data-lucide="book-open" class="w-5 h-5 text-[#CBB87C]"></i>
                    </div>
                    <h1 class="text-xl font-bold tracking-tight text-slate-900 dark:text-white">
                        Boiler<span class="text-slate-400 font-normal">Buddy</span>
                    </h1>
                </a>
            </div>

            <!-- Mobile Nav Toggle -->
            <button class="nav-toggle md:hidden" @click="mobileNavOpen = !mobileNavOpen" :aria-expanded="mobileNavOpen"
                aria-label="Toggle navigation menu" aria-controls="primary-nav">
                <i x-show="!mobileNavOpen" data-lucide="menu" class="w-6 h-6"></i>
                <i x-show="mobileNavOpen" data-lucide="x" class="w-6 h-6"></i>
            </button>

            <!-- Center: Navigation (Desktop) -->
            <nav id="primary-nav" class="app-header-nav hidden md:flex gap-1" aria-label="Primary navigation">

                <!-- Search Bar -->
                <div class="mr-6 hidden lg:block">
                    <div
                        class="nav-search flex items-center gap-2 px-3 py-1.5 bg-slate-50 dark:bg-slate-800/50 rounded-full border border-slate-200 dark:border-slate-700 focus-within:border-slate-300 dark:focus-within:border-slate-600 focus-within:bg-white dark:focus-within:bg-slate-800 transition-all w-64">
                        <i data-lucide="search" class="w-4 h-4 text-slate-400"></i>
                        <input type="text" placeholder="Search topics..."
                            class="bg-transparent border-none outline-none text-sm w-full placeholder-slate-400 text-slate-700 dark:text-slate-200">
                    </div>
                </div>

                <a href="{{ url_for('dashboard') }}"
                    class="nav-item px-4 py-2 rounded-full text-sm font-medium transition-all {% if request.endpoint == 'dashboard' %}bg-[#CBB87C]/10 dark:bg-[#CBB87C]/20 text-slate-900 dark:text-[#CBB87C] border border-[#CBB87C]/30{% else %}text-slate-600 dark:text-slate-400 hover:text-slate-900 dark:hover:text-white hover:bg-slate-50 dark:hover:bg-slate-800/50 border border-transparent{% endif %}"
                    aria-label="Go to Dashboard">
                    Home
                </a>

                <a href="{{ url_for('study') }}"
                    class="nav-item px-4 py-2 rounded-full text-sm font-medium transition-all {% if request.endpoint == 'study' %}bg-[#CBB87C]/10 dark:bg-[#CBB87C]/20 text-slate-900 dark:text-[#CBB87C] border border-[#CBB87C]/30{% else %}text-slate-600 dark:text-slate-400 hover:text-slate-900 dark:hover:text-white hover:bg-slate-50 dark:hover:bg-slate-800/50 border border-transparent{% endif %}"
                    aria-label="Go to Study">
                    Study
                </a>

                <a href="{{ url_for('group_study') }}"
                    class="nav-item px-4 py-2 rounded-full text-sm font-medium transition-all {% if request.endpoint == 'group_study' %}bg-[#CBB87C]/10 dark:bg-[#CBB87C]/20 text-slate-900 dark:text-[#CBB87C] border border-[#CBB87C]/30{% else %}text-slate-600 dark:text-slate-400 hover:text-slate-900 dark:hover:text-white hover:bg-slate-50 dark:hover:bg-slate-800/50 border border-transparent{% endif %}"
                    aria-label="Go to Group Study">
                    Group
                </a>

                <a href="{{ url_for('my_courses') }}"
                    class="nav-item px-4 py-2 rounded-full text-sm font-medium transition-all {% if request.endpoint == 'my_courses' %}bg-[#CBB87C]/10 dark:bg-[#CBB87C]/20 text-slate-900 dark:text-[#CBB87C] border border-[#CBB87C]/30{% else %}text-slate-600 dark:text-slate-400 hover:text-slate-900 dark:hover:text-white hover:bg-slate-50 dark:hover:bg-slate-800/50 border border-transparent{% endif %}"
                    aria-label="Go to My Courses">
                    My Courses
                </a>

                <a href="{{ url_for('dashboard') }}#leaderboard-section"
                    class="nav-item px-4 py-2 rounded-full text-sm font-medium transition-all text-slate-600 dark:text-slate-400 hover:text-slate-900 dark:hover:text-white hover:bg-slate-50 dark:hover:bg-slate-800/50 border border-transparent"
                    aria-label="Go to Leaderboard"
                    onclick="event.preventDefault(); document.getElementById('leaderboard-section').scrollIntoView({ behavior: 'smooth' });">
                    Leaderboard
                </a>

                <a href="{{ url_for('exams') }}"
                    class="nav-item px-4 py-2 rounded-full text-sm font-medium transition-all {% if request.endpoint == 'exams' %}bg-[#CBB87C]/10 dark:bg-[#CBB87C]/20 text-slate-900 dark:text-[#CBB87C] border border-[#CBB87C]/30{% else %}text-slate-600 dark:text-slate-400 hover:text-slate-900 dark:hover:text-white hover:bg-slate-50 dark:hover:bg-slate-800/50 border border-transparent{% endif %}"
                    aria-label="Go to Exams">
                    Exams
                </a>

                <!-- Primary Action -->
                <a href="{{ url_for('dev_exam_upload') }}"
                    class="ml-4 btn-primary-black text-sm font-medium flex items-center gap-2 shadow-sm"
                    aria-label="Upload">
                    <i data-lucide="upload" class="w-4 h-4"></i>
                    <span>Upload</span>
                </a>
            </nav>

            <!-- Mobile Navigation Menu -->
            <nav class="nav-menu-mobile" :class="{ 'is-open': mobileNavOpen }" aria-label="Mobile navigation menu"
                x-show="mobileNavOpen" x-cloak>
                <a href="{{ url_for('dashboard') }}"
                    class="nav-item {% if request.endpoint == 'dashboard' %}nav-item--active{% endif %}">
                    <i data-lucide="home" class="w-5 h-5"></i>
                    <span class="font-medium">Dashboard</span>
                </a>
                <a href="{{ url_for('study') }}"
                    class="nav-item {% if request.endpoint == 'study' %}nav-item--active{% endif %}">
                    <i data-lucide="book-open" class="w-5 h-5"></i>
                    <span class="font-medium">Study</span>
                </a>
                <a href="{{ url_for('dashboard') }}#leaderboard-section"
                    class="nav-item {% if request.endpoint == 'dashboard' %}nav-item--active{% endif %}"
                    onclick="event.preventDefault(); document.getElementById('leaderboard-section').scrollIntoView({ behavior: 'smooth' });">
                    <i data-lucide="trophy" class="w-5 h-5"></i>
                    <span class="font-medium">Rank</span>
                </a>
                <a href="{{ url_for('group_study') }}"
                    class="nav-item {% if request.endpoint == 'group_study' %}nav-item--active{% endif %}">
                    <i data-lucide="users" class="w-5 h-5"></i>
                    <span class="font-medium">Groups</span>
                </a>
            </nav>

            <!-- Right: User Profile (BoilerBuddy Style) -->
            <div class="app-header-right relative">
                <button @click="showUserMenu = !showUserMenu"
                    class="w-10 h-10 rounded-full bg-gradient-to-br from-[#D0B991] to-[#C2A070] flex items-center justify-center hover:opacity-80 transition-opacity"
                    aria-label="User menu">
                    <i data-lucide="user" class="w-5 h-5 text-white"></i>
                </button>
                <div x-show="showUserMenu" @click.away="showUserMenu = false" x-cloak
                    class="absolute right-0 top-12 rounded-lg shadow-xl p-2 min-w-[160px] z-50 border"
                    style="background-color: var(--bg-card); border-color: var(--border-card); color: var(--text-body);">
                    <div class="px-3 py-2 border-b" style="border-color: var(--border-card);">
                        <p class="font-medium text-sm" style="color: var(--text-heading);"
                            x-text="currentUser.username || 'Student'"></p>
                        <p class="text-xs" style="color: var(--text-muted);">Level <span
                                x-text="xpProgress.current_level || 1"></span></p>
                    </div>
                    <a href="{{ url_for('settings') }}"
                        class="w-full flex items-center gap-2 px-3 py-2 rounded-lg transition-colors text-sm hover:bg-black/5 dark:hover:bg-white/5">
                        <i data-lucide="settings" class="w-4 h-4"></i>
                        <span>Settings</span>
                    </a>
                    <a href="{{ url_for('achievements') }}"
                        class="w-full flex items-center gap-2 px-3 py-2 rounded-lg transition-colors text-sm hover:bg-black/5 dark:hover:bg-white/5">
                        <i data-lucide="award" class="w-4 h-4"></i>
                        <span>Achievements</span>
                    </a>
                    <button @click="logout(); showUserMenu = false"
                        class="w-full flex items-center gap-2 px-3 py-2 rounded-lg transition-colors text-sm hover:bg-black/5 dark:hover:bg-white/5">
                        <i data-lucide="log-out" class="w-4 h-4"></i>
                        <span>Logout</span>
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content Area -->
    <main class="app-main" role="main">
        {% block page_content %}{% endblock %}
    </main>

    <!-- Mobile Bottom Navigation (BoilerBuddy Style) -->
    <nav class="mobile-bottom-nav" aria-label="Mobile bottom navigation">
        <div class="mobile-bottom-nav-content">
            <a href="{{ url_for('dashboard') }}"
                class="mobile-bottom-nav-item {% if request.endpoint == 'dashboard' %}mobile-bottom-nav-item--active{% endif %}"
                aria-label="Dashboard">
                <i data-lucide="home" class="w-6 h-6"></i>
                <span>Home</span>
            </a>
            <a href="{{ url_for('study') }}"
                class="mobile-bottom-nav-item {% if request.endpoint == 'study' %}mobile-bottom-nav-item--active{% endif %}"
                aria-label="Study">
                <i data-lucide="book-open" class="w-6 h-6"></i>
                <span>Study</span>
            </a>
            <a href="{{ url_for('dashboard') }}#leaderboard-section"
                class="mobile-bottom-nav-item {% if request.endpoint == 'dashboard' %}mobile-bottom-nav-item--active{% endif %}"
                aria-label="Rank"
                onclick="event.preventDefault(); document.getElementById('leaderboard-section').scrollIntoView({ behavior: 'smooth' });">
                <i data-lucide="trophy" class="w-6 h-6"></i>
                <span>Rank</span>
            </a>
            <a href="{{ url_for('group_study') }}"
                class="mobile-bottom-nav-item {% if request.endpoint == 'group_study' %}mobile-bottom-nav-item--active{% endif %}"
                aria-label="Groups">
                <i data-lucide="users" class="w-6 h-6"></i>
                <span>Groups</span>
            </a>
        </div>
    </nav>
</div>
{% endblock %}