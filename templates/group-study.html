{% extends "layout.html" %}

{% block title %}Group Study - StudyBoiler{% endblock %}

{% block page_content %}
<div class="page">
    <div class="bg-white rounded-3xl shadow-lg p-6 border border-gray-200 mb-6">
        <div class="flex items-center justify-between mb-4">
            <a href="{{ url_for('dashboard') }}" class="p-2 hover:bg-gray-100 rounded-xl transition-colors">
                <i data-lucide="x" class="w-6 h-6"></i>
            </a>
            <div class="flex items-center gap-3">
                <i data-lucide="users" class="w-5 h-5 text-[#9B72CF]"></i>
                <div>
                    <h3 class="text-sm font-semibold">Group Study Session</h3>
                    <p class="text-xs text-gray-500">Code: <span x-text="sessionCode || 'ABC-123'"></span></p>
                </div>
            </div>
            <div class="flex items-center gap-2 text-gray-500">
                <i data-lucide="clock" class="w-4 h-4"></i>
                <span class="text-sm">24:15</span>
            </div>
        </div>
    </div>
    
    <div class="flex flex-col lg:flex-row gap-6">
        <!-- Left: Question feed -->
        <div class="flex-1 space-y-6">
            <!-- Current Question -->
            <div class="bg-white rounded-3xl shadow-lg p-6 border border-gray-200">
                <div class="flex items-center justify-between mb-4">
                    <span class="inline-block text-xs text-[#9B72CF] bg-[#9B72CF]/10 px-3 py-1 rounded-full">Current Question</span>
                    <div class="flex items-center gap-2">
                        <div class="flex -space-x-2">
                            <template x-for="member in activeMembers.filter(m => m.answered)" :key="member.id">
                                <div class="w-8 h-8 rounded-full bg-green-500 flex items-center justify-center border-2 border-white text-white text-xs">
                                    <i data-lucide="check-circle" class="w-4 h-4"></i>
                                </div>
                            </template>
                        </div>
                        <span class="text-sm text-gray-500" x-text="activeMembers.filter(m => m.answered).length + '/' + activeMembers.length + ' answered'"></span>
                    </div>
                </div>
                <h2 class="text-xl font-semibold mb-4" x-text="currentQuestion ? currentQuestion.question : 'Find the derivative of f(x) = 3x² + 2x - 5'"></h2>
                <div class="space-y-3">
                    <template x-for="(option, index) in (currentQuestion ? currentQuestion.options : ['6x + 2', '6x² + 2x', '3x + 2', '6x'])" :key="index">
                        <button class="w-full text-left p-4 rounded-2xl border-2 border-gray-200 hover:border-[#9B72CF]/50 hover:bg-[#9B72CF]/5 transition-all">
                            <div class="flex items-center gap-3">
                                <span class="w-8 h-8 rounded-full bg-gray-100 flex items-center justify-center text-sm" x-text="String.fromCharCode(65 + index)"></span>
                                <span x-text="option"></span>
                            </div>
                        </button>
                    </template>
                </div>
                <div class="mt-6 h-2 bg-gray-200 rounded-full overflow-hidden">
                    <div class="h-full w-3/4 bg-amber-500 rounded-full transition-all"></div>
                </div>
                <p class="text-xs text-gray-500 mt-2 text-center">Time remaining: 45 seconds</p>
            </div>
            
            <!-- Previous Questions -->
            <div class="bg-white rounded-3xl shadow-lg p-6 border border-gray-200">
                <h3 class="text-lg font-semibold mb-4">Previous Questions</h3>
                <div class="space-y-3">
                    <div class="p-4 bg-gray-50 rounded-2xl">
                        <p class="text-sm mb-2">Evaluate ∫x² dx</p>
                        <div class="flex items-center justify-between">
                            <span class="text-xs text-green-600">Answer: x³/3 + C</span>
                            <span class="text-xs text-gray-500">3/4 correct</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Right: Chat and members -->
        <div class="lg:w-96 flex flex-col border-t lg:border-t-0 lg:border-l border-gray-200">
            <!-- Active members -->
            <div class="p-4 border-b border-gray-200">
                <h4 class="mb-3 text-sm text-gray-500">Active Members</h4>
                <div class="space-y-2">
                    <template x-for="member in activeMembers" :key="member.id">
                        <div class="flex items-center gap-3">
                            <div class="w-10 h-10 rounded-full bg-[#9B72CF] flex items-center justify-center text-white relative">
                                <span x-text="member.avatar"></span>
                                <div class="absolute bottom-0 right-0 w-3 h-3 rounded-full border-2 border-white" 
                                     :class="member.status === 'active' ? 'bg-green-500' : 'bg-amber-500'"></div>
                            </div>
                            <div class="flex-1">
                                <p class="text-sm" x-text="member.name"></p>
                                <p class="text-xs text-gray-500" x-text="member.status === 'active' ? 'Active' : 'Thinking...'"></p>
                            </div>
                            <i x-show="member.answered" data-lucide="check-circle" class="w-5 h-5 text-green-600"></i>
                        </div>
                    </template>
                </div>
            </div>
            
            <!-- Chat -->
            <div class="flex-1 flex flex-col">
                <div class="flex-1 p-4 overflow-y-auto space-y-3">
                    <template x-for="msg in chatMessages" :key="msg.id">
                        <div :class="msg.isSystem ? 'text-center' : ''">
                            <template x-if="msg.isSystem">
                                <p class="text-xs text-gray-500 bg-gray-100 px-3 py-2 rounded-full inline-block" x-text="msg.message"></p>
                            </template>
                            <template x-if="!msg.isSystem">
                                <div>
                                    <div class="flex items-center gap-2 mb-1">
                                        <p class="text-xs" x-text="msg.user"></p>
                                        <span class="text-xs text-gray-500" x-text="msg.time"></span>
                                    </div>
                                    <div class="bg-gray-100 rounded-2xl rounded-tl-none px-4 py-2">
                                        <p class="text-sm" x-text="msg.message"></p>
                                    </div>
                                </div>
                            </template>
                        </div>
                    </template>
                </div>
                
                <!-- Message input -->
                <div class="p-4 border-t border-gray-200">
                    <div class="flex gap-2">
                        <input type="text" x-model="chatMessage" @keypress.enter="sendChatMessage()" placeholder="Type a message..." 
                               class="flex-1 px-4 py-3 rounded-2xl border-2 border-gray-200 bg-white focus:border-[#9B72CF] focus:outline-none focus:ring-2 focus:ring-[#9B72CF]/20">
                        <button @click="sendChatMessage()" :disabled="!chatMessage || !chatMessage.trim()" 
                                class="px-4 py-3 bg-[#9B72CF] text-white rounded-2xl hover:opacity-90 transition-opacity disabled:opacity-50 disabled:cursor-not-allowed">
                            <i data-lucide="send" class="w-5 h-5"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

