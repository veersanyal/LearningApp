{% extends "layout.html" %}

{% block title %}Dashboard - StudyBoiler{% endblock %}

{% block page_content %}
<div class="page">
    <!-- Welcome Section (BoilerBuddy Style) -->
    <div class="mb-8">
        <h1 class="text-3xl font-bold mb-2 text-white">
            Welcome back<span x-show="currentUser.username" x-text="`, ${currentUser.username || 'Student'}!`"></span><span x-show="!currentUser.username">!</span> ðŸ‘‹
        </h1>
        <p class="text-gray-400">You're crushing it! Keep up the momentum.</p>
    </div>

    <!-- Quick Stats (BoilerBuddy Style - Light Mode) -->
    <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-8">
        <div class="bg-gradient-to-br from-orange-50 to-orange-100/50 rounded-2xl p-6 border border-orange-200">
            <div class="flex items-center gap-3 mb-2">
                <i data-lucide="flame" class="w-6 h-6 text-orange-600"></i>
                <span class="text-sm text-orange-900 font-medium">Study Streak</span>
            </div>
            <p class="text-3xl font-bold text-orange-900" x-text="studyStreak + ' days'"></p>
        </div>
        <div class="bg-gradient-to-br from-purple-50 to-purple-100/50 rounded-2xl p-6 border border-purple-200">
            <div class="flex items-center gap-3 mb-2">
                <i data-lucide="target" class="w-6 h-6 text-purple-600"></i>
                <span class="text-sm text-purple-900 font-medium">Accuracy</span>
            </div>
            <p class="text-3xl font-bold text-purple-900" x-text="accuracy + '%'"></p>
        </div>
        <div class="bg-gradient-to-br from-amber-50 to-amber-100/50 rounded-2xl p-6 border border-amber-200">
            <div class="flex items-center gap-3 mb-2">
                <i data-lucide="trophy" class="w-6 h-6 text-amber-600"></i>
                <span class="text-sm text-amber-900 font-medium">Topics Mastered</span>
            </div>
            <p class="text-3xl font-bold text-amber-900" x-text="masteredTopics + '/' + allTopics.length"></p>
        </div>
        <div class="bg-gradient-to-br from-blue-50 to-blue-100/50 rounded-2xl p-6 border border-blue-200" x-show="examDate">
            <div class="flex items-center gap-3 mb-2">
                <i data-lucide="clock" class="w-6 h-6 text-blue-600"></i>
                <span class="text-sm text-blue-900 font-medium">Until Exam</span>
            </div>
            <p class="text-3xl font-bold text-blue-900" x-text="daysUntilExam + ' days'"></p>
        </div>
    </div>
    
    <!-- Main Content Grid (BoilerBuddy Style) -->
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
        <!-- Left Column - Next Review & Retention Graph -->
        <div class="lg:col-span-2 space-y-6">
            <!-- Next Review Card (BoilerBuddy Style) -->
            <div class="bg-white rounded-3xl shadow-lg p-6 border border-gray-200" x-show="allTopics.length > 0">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-xl font-semibold">Next Review</h3>
                    <span class="text-sm text-[#9B72CF] bg-[#9B72CF]/10 px-3 py-1 rounded-full" x-text="currentQuestion ? currentQuestion.difficulty : 'Medium'"></span>
                </div>
                <div class="mb-4" x-show="currentQuestion">
                    <p class="text-sm text-gray-600 mb-2" x-text="currentQuestion.topic_name || 'General'"></p>
                    <p class="text-xl mb-4 text-gray-900" x-text="currentQuestion.question || 'No question available'"></p>
                    <div class="h-2 bg-gray-200 rounded-full overflow-hidden">
                        <div class="h-full w-3/5 bg-[#9B72CF] rounded-full"></div>
                    </div>
                    <p class="text-xs text-gray-500 mt-2">Performance: Good â€¢ Due for review</p>
                </div>
                <a href="{{ url_for('study') }}" 
                   @click="loadNextQuestion()"
                   class="block w-full bg-[#9B72CF] text-white py-3 rounded-2xl hover:opacity-90 transition-opacity font-medium text-center">
                    Start Review Session
                </a>
            </div>
            
            <!-- Retention Graph (BoilerBuddy Style) -->
            <div class="bg-white rounded-3xl shadow-lg p-6 border border-gray-200">
                <div class="flex items-center gap-2 mb-6">
                    <i data-lucide="trending-up" class="w-5 h-5 text-[#9B72CF]"></i>
                    <h3 class="text-xl font-semibold">Your Retention Progress</h3>
                </div>
                <canvas id="retention-chart" width="400" height="200"></canvas>
            </div>
        </div>
        
        <!-- Right Column - Brain Map & Group Study CTA -->
        <div class="space-y-6">
            <!-- Brain Map Card (BoilerBuddy Style) -->
            <div class="bg-white rounded-3xl shadow-lg p-6 border border-gray-200" x-show="allTopics.length > 0">
                <h3 class="text-xl font-semibold mb-4">Brain Map</h3>
                <div class="space-y-3">
                    <template x-for="(topic, idx) in allTopics.slice(0, 6)" :key="topic.topic_id">
                        <div>
                            <div class="flex justify-between items-center mb-1">
                                <span class="text-sm text-gray-900" x-text="topic.name"></span>
                                <span class="text-xs font-medium" 
                                      :class="(topic.mastery || 0) > 0.8 ? 'text-green-600' : 'text-amber-600'"
                                      x-text="Math.round((topic.mastery || 0) * 100) + '%'"></span>
                            </div>
                            <div class="h-2 bg-gray-200 rounded-full overflow-hidden">
                                <div class="h-full rounded-full transition-all"
                                     :class="(topic.mastery || 0) > 0.8 ? 'bg-green-500' : 'bg-amber-400'"
                                     :style="'width: ' + Math.min((topic.mastery || 0) * 100, 100) + '%'"></div>
                            </div>
                        </div>
                    </template>
                </div>
            </div>
            
            <!-- Group Study CTA (BoilerBuddy Style) -->
            <div class="bg-gradient-to-br from-[#9B72CF]/20 to-[#9B72CF]/10 rounded-3xl shadow-lg p-6 border border-[#9B72CF]/30">
                <i data-lucide="users" class="w-10 h-10 text-[#9B72CF] mb-3"></i>
                <h3 class="text-xl font-semibold mb-2">Study Together</h3>
                <p class="text-sm text-gray-600 mb-4">Join a group session and learn with your peers</p>
                <a href="{{ url_for('group_study') }}" 
                   class="block w-full bg-[#9B72CF] text-white py-3 rounded-2xl hover:opacity-90 transition-opacity font-medium text-center">
                    Join Session
                </a>
            </div>
        </div>
    </div>
</div>
{% endblock %}

